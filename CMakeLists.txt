# Author: Pedro Vicente
# Detect JSON jansson library 
cmake_minimum_required(VERSION 3.1)
project (lib_netsockets)
set (CMAKE_CXX_STANDARD 11)
include_directories(${JANSSON_INCLUDE})
set(CMAKE_LIBRARY_PATH ${CMAKE_LIBRARY_PATH} ${JANSSON_LIBRARY})
find_library(JANSSON_LIBRARY jansson REQUIRED)
if(NOT JANSSON_LIBRARY)
  message(FATAL_ERROR "jansson library not found")
else()
  message("-- Found jansson library at: " ${JANSSON_LIBRARY})
endif()
if (MSVC)
  add_definitions( "/D_CRT_SECURE_NO_WARNINGS /D_WINSOCK_DEPRECATED_NO_WARNINGS" )
  if (STATIC_CRT)
    set(CMAKE_C_FLAGS_RELEASE "/MT")
    set(CMAKE_C_FLAGS_DEBUG "/MTd")
  endif()  
  set(WINSOCK_LIBRARY ws2_32.lib)
endif()
set(SOURCES socket.cc http.cc ftp.cc socket.hh http.hh ftp.hh)
add_executable(tcp_client_01 tcp_client_01.cc ${SOURCES})
add_executable(tcp_server_01 tcp_server_01.cc ${SOURCES})
add_executable(http_client http_client.cc ${SOURCES})
add_executable(http_server http_server.cc ${SOURCES})
add_executable(ftp_client ftp_client.cc ${SOURCES})
target_link_libraries (tcp_client_01 ${JANSSON_LIBRARY} ${WINSOCK_LIBRARY})
target_link_libraries (tcp_server_01 ${JANSSON_LIBRARY} ${WINSOCK_LIBRARY})
target_link_libraries (http_client ${JANSSON_LIBRARY} ${WINSOCK_LIBRARY})
target_link_libraries (http_server ${JANSSON_LIBRARY} ${WINSOCK_LIBRARY})
target_link_libraries (ftp_client ${JANSSON_LIBRARY} ${WINSOCK_LIBRARY})
